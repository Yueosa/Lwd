# 已知问题与限制

版本 1.1.0 · 2025-02

---

## 架构设计折中

### 回退基于从头重放

回退操作（◂/⏮）通过清空世界后从第 0 步重新执行到目标位置实现。这意味着：
- 回退到第 N 步需要执行 N 次子步骤
- 大世界 + 多步骤时，从末尾回退到早期步骤可达数秒
- 好处是实现简单、不占额外内存，且每个步骤无需实现撤销逻辑

### 快照不含方块数据

`.lwd` 快照仅保存种子、参数和层级配置（约 2KB），不包含实际方块数据。导入时通过重放还原。如果算法代码在版本间发生变化，旧快照重放结果可能与原始生成不同。

### 单层世界

当前世界只有一个前景方块层（`Vec<u8>`），不支持前景/背景/液体等多层结构。这是未来架构扩展点。

### 数据类型上限

方块 ID 和环境 ID 均为 `u8`，最多各 256 种。当前 43 种方块 + 10 种环境远未达上限，但未来大量扩展时需要升级。

---

## UI 限制

### 几何预览无"映射到世界"功能

几何预览窗口只能独立查看步骤的形状，暂时不能将形状叠加到主画布上显示。

### 沙箱功能待完善

图形 API 沙箱目前不支持：
- 将创建的形状导出到算法步骤
- 自定义形状颜色

### 自定义世界尺寸无上限

自定义尺寸输入只校验正整数，不设置上限或内存预警。输入过大的尺寸（如 100000×100000）可能导致内存不足。

---

## 性能特征

### 内存占用估算

大世界（8400×2400）各组件：

| 组件 | 占用 |
|------|------|
| 世界方块数据 | ~20 MB |
| 环境地图 | ~20 MB |
| GPU 纹理（LOD 降采样） | 10\~40 MB |
| egui 运行时缓存 | ~50 MB |
| 合计 | 约 200\~400 MB |

### 字体内嵌

中文字体（Noto Sans CJK SC, 16MB）和符号字体（657KB）通过 `include_bytes!` 编译进二进制，确保无外部文件依赖，但 strip 后的二进制仍约 13MB。

### 步骤执行在主线程

每个子步骤在 UI 线程同步执行。`执行到底` 模式通过 `AdaptiveBatchSize` 控制每帧执行的步数来维持流畅度，但单个耗时步骤仍可能造成短暂卡顿。

---

## 平台说明

| 平台 | 状态 |
|------|------|
| Linux x86_64 | 主要开发和测试平台 |
| Windows x86_64 | 通过 `x86_64-pc-windows-gnu` 交叉编译，有限测试 |
| macOS | 不提供构建 |

GPU 渲染要求 **OpenGL 3.1+**（GLSL `#version 140`），不支持 OpenGL ES 或更旧硬件。

---

## 待实现功能

| 功能 | 分类 |
|------|------|
| Phase 2：地形生成（地表线、洞穴、矿石） | 生成算法 |
| Phase 3：结构生成（建筑物、宝箱） | 生成算法 |
| 多层世界（前景/背景/液体） | 引擎架构 |
| 扩展图形类型（胶囊、多边形、贝塞尔曲线、噪声边界、Voronoi、圆环） | 图形 API |
| 图形定义配置化（从代码抽离为可注册系统） | 图形 API |
| 几何预览"映射到世界"按钮 | UI |
| 沙箱形状导出至算法 | UI |

---

## 1.1.0 已修复问题

以下问题在 1.1.0 版本中已解决：

- ~~自定义世界尺寸 UI 不提供输入~~ → 已实现完整的自定义宽高输入
- ~~环境标签扫描全世界 (~135ms/帧)~~ → 改为仅扫描可见视口 + 自适应步长
- ~~标签拖拽/缩放时抖动~~ → BiomeLabelCache 世界坐标缓存
- ~~egui 三角化性能瓶颈~~ → PaintCallback + glow 直接 GPU 渲染
- ~~全世界像素每帧刷新~~ → 3× 视口缓冲 + 动态 LOD
- ~~硬编码并行阈值~~ → 运行时自校准（EngineConfig）
- ~~硬编码 batch size~~ → AdaptiveBatchSize EMA 自适应
